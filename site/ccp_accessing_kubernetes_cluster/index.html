
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Welcome to our ACI Automation Training with Practice Lab">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.16">
    
    
      
        <title>Accessing Kubernetes Cluster - ACI Automation Training</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1c3799f8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#accessing-kubernetes-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ACI Automation Training" class="md-header__button md-logo" aria-label="ACI Automation Training" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ACI Automation Training
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Accessing Kubernetes Cluster
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ACI Automation Training" class="md-nav__button md-logo" aria-label="ACI Automation Training" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ACI Automation Training
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Lab Access
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Lab Access" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Lab Access
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LAB_access/" class="md-nav__link">
        Accessing the Lab Environment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Day1 LAB sections
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day1 LAB sections" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Day1 LAB sections
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../restAPI/" class="md-nav__link">
        Automation basis with restAPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fw-use-cases-postman/" class="md-nav__link">
        Create customer use-cases with Postman
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fw-monitor-aci/" class="md-nav__link">
        How to pull informations using restAPI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Day2 LAB sections
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day2 LAB sections" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Day2 LAB sections
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-basis/" class="md-nav__link">
        Terraform setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fw-terraform-usecases/" class="md-nav__link">
        Customer use-cases with Terraform
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Appendixes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Appendixes" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Appendixes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guacamole/" class="md-nav__link">
        dCloudGuacamole
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kubectl-kubernetes-command-line-interface" class="md-nav__link">
    Kubectl - Kubernetes Command Line Interface
  </a>
  
    <nav class="md-nav" aria-label="Kubectl - Kubernetes Command Line Interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-kubeconfig-file-from-both-created-kubernetes-clusters" class="md-nav__link">
    Getting kubeconfig file from both created Kubernetes Clusters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge-eks-kubeconfig-file-with-existing-kubeconfig-file-for-on-premise-kubernetes" class="md-nav__link">
    Merge EKS kubeconfig file with existing kubeconfig file for on-premise Kubernetes.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iam-aws-authentication-for-eks-cluster" class="md-nav__link">
    IAM AWS Authentication for EKS cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validate-access-to-k8s-clusters-from-jumphost" class="md-nav__link">
    Validate access to K8s Clusters from jumphost
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="accessing-kubernetes-cluster">Accessing Kubernetes Cluster</h1>
<h2 id="kubectl-kubernetes-command-line-interface">Kubectl - Kubernetes Command Line Interface</h2>
<h3 id="getting-kubeconfig-file-from-both-created-kubernetes-clusters">Getting kubeconfig file from both created Kubernetes Clusters</h3>
<p>While most of the options in Kubernetes are available through the dashboard, CLI commands are also available, and convenient to use. Kubectl is a software leveraging Kubernetes API and translate commands to specific API calls. This tool will be used during the lab.</p>
<p>Once connectivity to your new EKS Kubernetes Cluster is confirmed, go back to Cisco Container Platform (CCP) web page, login if required and select Clusters -&gt; vSphere to display your newely created Kubernetes cluster.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/HOLCLD-2101/master/images/ccp-cluster-onprem-5.png"></p>
<ul>
<li><strong>Step 1:</strong> Accessing new Kubernetes cluster requires to obtain the kubeconfig file. Click on the name of your cluster to see the detailed view.</li>
</ul>
<p><img src="https://raw.githubusercontent.com/marcinduma/HOLCLD-2101/master/images/ccp-download-kubeconfig-onprem.png"></p>
<ul>
<li>
<p><strong>Step 2:</strong> Download kubeconfig file, make sure the file name is <code>on-prem-backend-kubeconfig.yaml</code>.</p>
</li>
<li>
<p><strong>Step 3:</strong> Copy kubeconfig file to your linux jumphost machine using SCP. Open WinSCP from the desktop, and login to Linux Jumphost using your credentials.</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/marcinduma/HOLCLD-2101/master/images/scp.png"></p>
<p>Copy kubeconfig file into your home directory (this is the directory opened after successful login)</p>
<p>Time to copy second kubeconfig for your AWS Kubernetes Cluster.</p>
<p>On CCP Dashboard go to <strong>Clusters -&gt; AWS</strong> to display your newely created Kubernetes EKS cluster.</p>
<ul>
<li><strong>Step 1:</strong> Accessing new Kubernetes cluster requires to obtain the kubeconfig file. Click on the name of your cluster to see the detailed view.</li>
</ul>
<p><img src="https://raw.githubusercontent.com/marcinduma/HOLCLD-2101/master/images/ccp-eks-download-kubeconfig.png"></p>
<ul>
<li><strong>Step 2:</strong> Copy kubeconfig file to your linux jumphost machine using SCP. Open WinSCP from the desktop, and login to Linux Jumphost using your credentials.</li>
</ul>
<p><img src="https://raw.githubusercontent.com/marcinduma/HOLCLD-2101/master/images/scp.png"></p>
<p>Copy kubeconfig file into your home directory (this is the directory opened after successful login)</p>
<h3 id="merge-eks-kubeconfig-file-with-existing-kubeconfig-file-for-on-premise-kubernetes">Merge EKS kubeconfig file with existing kubeconfig file for on-premise Kubernetes.</h3>
<p>SSH to Linux jumphost using PuTTY, confirm that BOTH your kubeconfig files have been copied to home directory</p>
<pre><code>ls -lt
</code></pre>
<p><img src="https://raw.githubusercontent.com/marcinduma/HOLCLD-2101/master/images/linux-kubeconfig-in-home-2.png"></p>
<p>Merging kubeconfig files let you switch between contexts using kubectl tool, rather specifying full path to your kubeconfig file in every command.
This command will merge kubeconfig files and create new file in <code>~/.kube/config</code>. This is the default location for kubectl to find access information to particular Kubernetes Cluster.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Before you merge the kubeconfig files, please verify file extention. It can happen that it is saved as <strong>.yml</strong> not <strong>.yaml</strong>. Correct next command when necessary.</p>
</div>
<p>Merge command:</p>
<pre><code>KUBECONFIG=~/on-prem-backend-kubeconfig.yaml:~/kubeconfig.yaml kubectl config view --flatten &gt; ~/.kube/config
</code></pre>
<p>List files again in <code>~/.kube/config</code> directory to make sure that new <code>config</code> file is there.</p>
<pre><code>cd .kube
ls -la
</code></pre>
<p><img src="https://raw.githubusercontent.com/marcinduma/HOLCLD-2101/master/images/linux-kubeconfig-merge-2.png"></p>
<h3 id="iam-aws-authentication-for-eks-cluster">IAM AWS Authentication for EKS cluster</h3>
<ul>
<li>
<p><strong>Step 1:</strong> Kubeconfig file usually contains private certificate that is uathorized by kubernetes directly. In case of EKS, AWS IAM authenthentication is involved. Instead of certificate, we will use your AWS access keypair to authenticate. On the linux jumphost, aws cli tool is installed. Similarily to kubectl this tool provides management access to your AWS account. Using this tool you can spawn new VM or create new networking infrastructure like VPC, subnets etc. In this lab, aws cli is leveraged by IAM-Authenticator module to sign kubectl requests towards EKS using Secure Token Service (STS) in AWS.</p>
</li>
<li>
<p><strong>Step 2:</strong> Configure aws cli with your access key.</p>
</li>
</ul>
<p>In Linux jumphost console, type:</p>
<pre><code>aws configure
</code></pre>
<p>Provide the Access Key and Secret obtained in the previous task (AWS Tenant Cluster creation), you should have them saved in notepad.</p>
<pre><code>    AWS Access Key ID [None]:
    AWS Secret Access Key [None]:
    Default region name [None]: eu-central-1
    Default output format [None]: text
</code></pre>
<blockquote>
<p>Make sure to enter exact name of region: <strong>eu-central-1</strong> and <strong>text</strong> as a default output format.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/marcinduma/HOLCLD-2101/master/images/aws-cli-configure-2.png"></p>
<h2 id="validate-access-to-k8s-clusters-from-jumphost">Validate access to K8s Clusters from jumphost</h2>
<p>Validate if your kubeconfigs has been correctly imported:</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>For AWS EKS Cluster, as well as for on-prem you will have full admin rights.</p>
</div>
<p>List updated contexts:</p>
<pre><code>kubectl config get-contexts
</code></pre>
<p><img src="https://raw.githubusercontent.com/marcinduma/HOLCLD-2101/master/images/kubectl-config-get-contexts.png"></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Star indicates which kubernetes cluster you will manage using kubectl</p>
</div>
<p>If you would like to change context to aws EKS Kubernetes Cluster, please use following command:</p>
<pre><code>kubectl config use-context aws
kubectl config get-contexts
</code></pre>
<p><img src="https://raw.githubusercontent.com/marcinduma/HOLCLD-2101/master/images/kubectl-context-aws.png"></p>
<p>Validate your access and list Kubernetes nodes in AWS EKS Cluster</p>
<pre><code>kubectl get nodes
</code></pre>
<p><img src="https://raw.githubusercontent.com/marcinduma/HOLCLD-2101/master/images/kubectl-get-nodes-aws-2.png"></p>
<p>To change context to on-premise Kuberenetes Cluster use follwing command:</p>
<pre><code>kubectl config use-context admin@on-prem-backend
kubectl config get-contexts
</code></pre>
<p>Validate your access and list Kubernetes nodes in on-premise Cluster</p>
<pre><code>kubectl get nodes
</code></pre>
<p><img src="https://raw.githubusercontent.com/marcinduma/HOLCLD-2101/master/images/kubectl-nodes-on-prem.png"></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.3a4b43e5.min.js"></script>
      
    
  </body>
</html>